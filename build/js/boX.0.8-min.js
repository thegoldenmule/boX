(function(e){function c(j,i,g,h,f){this._listener=i;this._isOnce=g;this.context=h;this._signal=j;this._priority=f||0}c.prototype={active:true,params:null,execute:function(f){var h,g;if(this.active&&!!this._listener){g=this.params?this.params.concat(f):f;h=this._listener.apply(this.context,g);if(this._isOnce){this.detach()}}return h},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function a(f,g){if(typeof f!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",g))}}function d(){this._bindings=[];this._prevParams=null;var f=this;this.dispatch=function(){d.prototype.dispatch.apply(f,arguments)}}d.prototype={VERSION:"1.0.0",memorize:false,_shouldPropagate:true,active:true,_registerListener:function(j,h,i,g){var f=this._indexOfListener(j,i),k;if(f!==-1){k=this._bindings[f];if(k.isOnce()!==h){throw new Error("You cannot add"+(h?"":"Once")+"() then add"+(!h?"":"Once")+"() the same listener without removing the relationship first.")}}else{k=new c(this,j,h,i,g);this._addBinding(k)}if(this.memorize&&this._prevParams){k.execute(this._prevParams)}return k},_addBinding:function(f){var g=this._bindings.length;do{--g}while(this._bindings[g]&&f._priority<=this._bindings[g]._priority);this._bindings.splice(g+1,0,f)},_indexOfListener:function(g,f){var i=this._bindings.length,h;while(i--){h=this._bindings[i];if(h._listener===g&&h.context===f){return i}}return -1},has:function(g,f){return this._indexOfListener(g,f)!==-1},add:function(h,g,f){a(h,"add");return this._registerListener(h,false,g,f)},addOnce:function(h,g,f){a(h,"addOnce");return this._registerListener(h,true,g,f)},remove:function(h,g){a(h,"remove");var f=this._indexOfListener(h,g);if(f!==-1){this._bindings[f]._destroy();this._bindings.splice(f,1)}return h},removeAll:function(){var f=this._bindings.length;while(f--){this._bindings[f]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(g){if(!this.active){return}var f=Array.prototype.slice.call(arguments),i=this._bindings.length,h;if(this.memorize){this._prevParams=f}if(!i){return}h=this._bindings.slice();this._shouldPropagate=true;do{i--}while(h[i]&&this._shouldPropagate&&h[i].execute(f)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var b=d;b.Signal=d;if(typeof define==="function"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}else{e.signals=b}}}(this));WebGLDebugUtils=function(){var f=function(p){if(window.console&&window.console.log){window.console.log(p)}};var i=function(p){if(window.console&&window.console.error){window.console.error(p)}else{f(p)}};var o={enable:{0:true},disable:{0:true},getParameter:{0:true},drawArrays:{0:true},drawElements:{0:true,2:true},createShader:{0:true},getShaderParameter:{1:true},getProgramParameter:{1:true},getVertexAttrib:{1:true},vertexAttribPointer:{2:true},bindTexture:{0:true},activeTexture:{0:true},getTexParameter:{0:true,1:true},texParameterf:{0:true,1:true},texParameteri:{0:true,1:true,2:true},texImage2D:{0:true,2:true,6:true,7:true},texSubImage2D:{0:true,6:true,7:true},copyTexImage2D:{0:true,2:true},copyTexSubImage2D:{0:true},generateMipmap:{0:true},bindBuffer:{0:true},bufferData:{0:true,2:true},bufferSubData:{0:true},getBufferParameter:{0:true,1:true},pixelStorei:{0:true,1:true},readPixels:{4:true,5:true},bindRenderbuffer:{0:true},bindFramebuffer:{0:true},checkFramebufferStatus:{0:true},framebufferRenderbuffer:{0:true,1:true,2:true},framebufferTexture2D:{0:true,1:true,2:true},getFramebufferAttachmentParameter:{0:true,1:true,2:true},getRenderbufferParameter:{0:true,1:true},renderbufferStorage:{0:true,1:true},clear:{0:true},depthFunc:{0:true},blendFunc:{0:true,1:true},blendFuncSeparate:{0:true,1:true,2:true,3:true},blendEquation:{0:true},blendEquationSeparate:{0:true,1:true},stencilFunc:{0:true},stencilFuncSeparate:{0:true,1:true},stencilMaskSeparate:{0:true},stencilOp:{0:true,1:true,2:true},stencilOpSeparate:{0:true,1:true,2:true,3:true},cullFace:{0:true},frontFace:{0:true}};var n=null;function m(p){if(n==null){n={};for(var q in p){if(typeof p[q]=="number"){n[p[q]]=q}}}}function g(){if(n==null){throw"WebGLDebugUtils.init(ctx) not called"}}function b(p){g();return(n[p]!==undefined)}function c(q){g();var p=n[q];return(p!==undefined)?p:("*UNKNOWN WebGL ENUM (0x"+q.toString(16)+")")}function e(s,q,r){var p=o[s];if(p!==undefined){if(p[q]){return c(r)}}if(r===null){return"null"}else{if(r===undefined){return"undefined"}else{return r.toString()}}}function j(r,p){var s="";for(var q=0;q<p.length;++q){s+=((q==0)?"":", ")+e(r,q,p[q])}return s}function a(r,q,p){r.__defineGetter__(p,function(){return q[p]});r.__defineSetter__(p,function(s){q[p]=s})}function k(p,r){var q=p[r];return function(){var s=q.apply(p,arguments);return s}}function l(q,t,p){m(q);t=t||function(y,z,w){var A="";for(var x=0;x<w.length;++x){A+=((x==0)?"":", ")+e(z,x,w[x])}i("WebGL error "+c(y)+" in "+z+"("+A+")")};var v={};function s(w,x){return function(){if(p){p(x,arguments)}var y=w[x].apply(w,arguments);var z=w.getError();if(z!=0){v[z]=true;t(z,x,arguments)}return y}}var u={};for(var r in q){if(typeof q[r]=="function"){u[r]=s(q,r)}else{a(u,q,r)}}u.getError=function(){for(var w in v){if(v.hasOwnProperty(w)){if(v[w]){v[w]=false;return w}}}return q.NO_ERROR};return u}function h(p){var t=p.getParameter(p.MAX_VERTEX_ATTRIBS);var q=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,q);for(var s=0;s<t;++s){p.disableVertexAttribArray(s);p.vertexAttribPointer(s,4,p.FLOAT,false,0,0);p.vertexAttrib1f(s,0)}p.deleteBuffer(q);var r=p.getParameter(p.MAX_TEXTURE_IMAGE_UNITS);for(var s=0;s<r;++s){p.activeTexture(p.TEXTURE0+s);p.bindTexture(p.TEXTURE_CUBE_MAP,null);p.bindTexture(p.TEXTURE_2D,null)}p.activeTexture(p.TEXTURE0);p.useProgram(null);p.bindBuffer(p.ARRAY_BUFFER,null);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,null);p.bindFramebuffer(p.FRAMEBUFFER,null);p.bindRenderbuffer(p.RENDERBUFFER,null);p.disable(p.BLEND);p.disable(p.CULL_FACE);p.disable(p.DEPTH_TEST);p.disable(p.DITHER);p.disable(p.SCISSOR_TEST);p.blendColor(0,0,0,0);p.blendEquation(p.FUNC_ADD);p.blendFunc(p.ONE,p.ZERO);p.clearColor(0,0,0,0);p.clearDepth(1);p.clearStencil(-1);p.colorMask(true,true,true,true);p.cullFace(p.BACK);p.depthFunc(p.LESS);p.depthMask(true);p.depthRange(0,1);p.frontFace(p.CCW);p.hint(p.GENERATE_MIPMAP_HINT,p.DONT_CARE);p.lineWidth(1);p.pixelStorei(p.PACK_ALIGNMENT,4);p.pixelStorei(p.UNPACK_ALIGNMENT,4);p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,false);p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(p.UNPACK_COLORSPACE_CONVERSION_WEBGL){p.pixelStorei(p.UNPACK_COLORSPACE_CONVERSION_WEBGL,p.BROWSER_DEFAULT_WEBGL)}p.polygonOffset(0,0);p.sampleCoverage(1,false);p.scissor(0,0,p.canvas.width,p.canvas.height);p.stencilFunc(p.ALWAYS,0,4294967295);p.stencilMask(4294967295);p.stencilOp(p.KEEP,p.KEEP,p.KEEP);p.viewport(0,0,p.canvas.width,p.canvas.height);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT|p.STENCIL_BUFFER_BIT);while(p.getError()){}}function d(v){var r;var I;var K=[];var z=[];var I={};var C=1;var E=false;var B=0;var N=[];var p=0;var q=0;var w=false;var H=0;var t={};v.getContext=function(P){return function(){var Q=P.apply(v,arguments);if(Q instanceof WebGLRenderingContext){if(Q!=r){if(r){throw"got different context"}r=Q;I=O(r)}return I}return Q}}(v.getContext);function u(P){if(typeof(P)=="function"){return P}else{return function(Q){P.handleEvent(Q)}}}var G=function(P){K.push(u(P))};var y=function(P){z.push(u(P))};function A(P){var Q=P.addEventListener;P.addEventListener=function(S,T,R){switch(S){case"webglcontextlost":G(T);break;case"webglcontextrestored":y(T);break;default:Q.apply(P,arguments)}}}A(v);v.loseContext=function(){if(!E){E=true;p=0;++C;while(r.getError()){}J();t[r.CONTEXT_LOST_WEBGL]=true;var Q=D("context lost");var P=K.slice();setTimeout(function(){for(var R=0;R<P.length;++R){P[R](Q)}if(H>=0){setTimeout(function(){v.restoreContext()},H)}},0)}};v.restoreContext=function(){if(E){if(z.length){setTimeout(function(){if(!w){throw"can not restore. webglcontestlost listener did not call event.preventDefault"}L();h(r);E=false;q=0;w=false;var R=z.slice();var Q=D("context restored");for(var P=0;P<R.length;++P){R[P](Q)}},0)}}};v.loseContextInNCalls=function(P){if(E){throw"You can not ask a lost contet to be lost"}p=q+P};v.getNumCalls=function(){return q};v.setRestoreTimeout=function(P){H=P};function s(P){return(P instanceof WebGLBuffer||P instanceof WebGLFramebuffer||P instanceof WebGLProgram||P instanceof WebGLRenderbuffer||P instanceof WebGLShader||P instanceof WebGLTexture)}function M(Q){for(var R=0;R<Q.length;++R){var P=Q[R];if(s(P)){return P.__webglDebugContextLostId__==C}}return true}function J(){var P=Object.keys(t);for(var Q=0;Q<P.length;++Q){delete t[P]}}function x(){++q;if(!E){if(p==q){v.loseContext()}}}function F(P,R){var Q=P[R];return function(){x();if(!E){var S=Q.apply(P,arguments);return S}}}function L(){for(var P=0;P<N.length;++P){var Q=N[P];if(Q instanceof WebGLBuffer){r.deleteBuffer(Q)}else{if(Q instanceof WebGLFramebuffer){r.deleteFramebuffer(Q)}else{if(Q instanceof WebGLProgram){r.deleteProgram(Q)}else{if(Q instanceof WebGLRenderbuffer){r.deleteRenderbuffer(Q)}else{if(Q instanceof WebGLShader){r.deleteShader(Q)}else{if(Q instanceof WebGLTexture){r.deleteTexture(Q)}}}}}}}}function D(P){return{statusMessage:P,preventDefault:function(){w=true}}}return v;function O(Q){for(var R in Q){if(typeof Q[R]=="function"){I[R]=F(Q,R)}else{a(I,Q,R)}}I.getError=function(){x();if(!E){var W;while(W=r.getError()){t[W]=true}}for(var W in t){if(t[W]){delete t[W];return W}}return I.NO_ERROR};var V=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(var S=0;S<V.length;++S){var U=V[S];I[U]=function(W){return function(){x();if(E){return null}var X=W.apply(Q,arguments);X.__webglDebugContextLostId__=C;N.push(X);return X}}(Q[U])}var T=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(var S=0;S<T.length;++S){var U=T[S];I[U]=function(W){return function(){x();if(E){return null}return W.apply(Q,arguments)}}(I[U])}var P=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(var S=0;S<P.length;++S){var U=P[S];I[U]=function(W){return function(){x();if(E){return false}return W.apply(Q,arguments)}}(I[U])}I.checkFramebufferStatus=function(W){return function(){x();if(E){return I.FRAMEBUFFER_UNSUPPORTED}return W.apply(Q,arguments)}}(I.checkFramebufferStatus);I.getAttribLocation=function(W){return function(){x();if(E){return -1}return W.apply(Q,arguments)}}(I.getAttribLocation);I.getVertexAttribOffset=function(W){return function(){x();if(E){return 0}return W.apply(Q,arguments)}}(I.getVertexAttribOffset);I.isContextLost=function(){return E};return I}}return{init:m,mightBeEnum:b,glEnumToString:c,glFunctionArgToString:e,glFunctionArgsToString:j,makeDebugContext:l,makeLostContextSimulatingCanvas:d,resetToInitialState:h}}();if(!GLMAT_EPSILON){var GLMAT_EPSILON=0.000001}if(!GLMAT_ARRAY_TYPE){var GLMAT_ARRAY_TYPE=(typeof Float32Array!=="undefined")?Float32Array:Array}var glMatrix={};glMatrix.setMatrixArrayType=function(a){GLMAT_ARRAY_TYPE=a};if(typeof(exports)!=="undefined"){exports.glMatrix=glMatrix}var mat2={};var mat2Identity=new Float32Array([1,0,0,1]);mat2.create=function(){var a=new GLMAT_ARRAY_TYPE(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};mat2.clone=function(b){var c=new GLMAT_ARRAY_TYPE(4);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];return c};mat2.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];return c};mat2.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};mat2.transpose=function(d,c){if(d===c){var b=c[1];d[1]=c[2];d[2]=b}else{d[0]=c[0];d[1]=c[2];d[2]=c[1];d[3]=c[3]}return d};mat2.invert=function(f,d){var e=d[0],c=d[1],b=d[2],h=d[3],g=e*h-b*c;if(!g){return null}g=1/g;f[0]=h*g;f[1]=-c*g;f[2]=-b*g;f[3]=e*g;return f};mat2.adjoint=function(d,b){var c=b[0];d[0]=b[3];d[1]=-b[1];d[2]=-b[2];d[3]=c;return d};mat2.determinant=function(b){return b[0]*b[3]-b[2]*b[1]};mat2.multiply=function(g,l,j){var f=l[0],e=l[1],d=l[2],c=l[3];var m=j[0],k=j[1],i=j[2],h=j[3];g[0]=f*m+e*i;g[1]=f*k+e*h;g[2]=d*m+c*i;g[3]=d*k+c*h;return g};mat2.mul=mat2.multiply;mat2.rotate=function(g,j,i){var f=j[0],e=j[1],d=j[2],b=j[3],k=Math.sin(i),h=Math.cos(i);g[0]=f*h+e*k;g[1]=f*-k+e*h;g[2]=d*h+b*k;g[3]=d*-k+b*h;return g};mat2.scale=function(f,g,i){var e=g[0],d=g[1],c=g[2],b=g[3],j=i[0],h=i[1];f[0]=e*j;f[1]=d*h;f[2]=c*j;f[3]=b*h;return f};mat2.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};if(typeof(exports)!=="undefined"){exports.mat2=mat2}var mat2d={};var mat2dIdentity=new Float32Array([1,0,0,1,0,0]);mat2d.create=function(){var a=new GLMAT_ARRAY_TYPE(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};mat2d.clone=function(b){var c=new GLMAT_ARRAY_TYPE(6);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];return c};mat2d.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];return c};mat2d.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};mat2d.invert=function(c,g){var b=g[0],j=g[1],i=g[2],h=g[3],e=g[4],d=g[5];var f=b*h-j*i;if(!f){return null}f=1/f;c[0]=h*f;c[1]=-j*f;c[2]=-i*f;c[3]=b*f;c[4]=(i*d-h*e)*f;c[5]=(j*e-b*d)*f;return c};mat2d.determinant=function(b){return b[0]*b[3]-b[1]*b[2]};mat2d.multiply=function(d,n,m){var c=n[0],q=n[1],p=n[2],o=n[3],f=n[4],e=n[5],k=m[0],i=m[1],h=m[2],g=m[3],l=m[4],j=m[5];d[0]=c*k+q*h;d[1]=c*i+q*g;d[2]=p*k+o*h;d[3]=p*i+o*g;d[4]=k*f+h*e+l;d[5]=i*f+g*e+j;return d};mat2d.mul=mat2d.multiply;mat2d.rotate=function(c,h,g){var b=h[0],l=h[1],k=h[2],i=h[3],f=h[4],d=h[5],j=Math.sin(g),e=Math.cos(g);c[0]=b*e+l*j;c[1]=-b*j+l*e;c[2]=k*e+i*j;c[3]=-k*j+e*i;c[4]=e*f+j*d;c[5]=e*d-j*f;return c};mat2d.scale=function(d,b,c){var f=c[0],e=c[1];d[0]=b[0]*f;d[1]=b[1]*e;d[2]=b[2]*f;d[3]=b[3]*e;d[4]=b[4]*f;d[5]=b[5]*e;return d};mat2d.translate=function(d,b,c){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4]+c[0];d[5]=b[5]+c[1];return d};mat2d.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};if(typeof(exports)!=="undefined"){exports.mat2d=mat2d}var mat3={};var mat3Identity=new Float32Array([1,0,0,0,1,0,0,0,1]);mat3.create=function(){var a=new GLMAT_ARRAY_TYPE(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};mat3.clone=function(b){var c=new GLMAT_ARRAY_TYPE(9);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];return c};mat3.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];return c};mat3.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};mat3.transpose=function(d,c){if(d===c){var f=c[1],e=c[2],b=c[5];d[1]=c[3];d[2]=c[6];d[3]=f;d[5]=c[7];d[6]=e;d[7]=b}else{d[0]=c[0];d[1]=c[3];d[2]=c[6];d[3]=c[1];d[4]=c[4];d[5]=c[7];d[6]=c[2];d[7]=c[5];d[8]=c[8]}return d};mat3.invert=function(f,m){var e=m[0],d=m[1],c=m[2],p=m[3],o=m[4],n=m[5],k=m[6],j=m[7],h=m[8],g=h*o-n*j,b=-h*p+n*k,l=j*p-o*k,i=e*g+d*b+c*l;if(!i){return null}i=1/i;f[0]=g*i;f[1]=(-h*d+c*j)*i;f[2]=(n*d-c*o)*i;f[3]=b*i;f[4]=(h*e-c*k)*i;f[5]=(-n*e+c*p)*i;f[6]=l*i;f[7]=(-j*e+d*k)*i;f[8]=(o*e-d*p)*i;return f};mat3.adjoint=function(e,i){var d=i[0],c=i[1],b=i[2],l=i[3],k=i[4],j=i[5],h=i[6],g=i[7],f=i[8];e[0]=(k*f-j*g);e[1]=(b*g-c*f);e[2]=(c*j-b*k);e[3]=(j*h-l*f);e[4]=(d*f-b*h);e[5]=(b*l-d*j);e[6]=(l*g-k*h);e[7]=(c*h-d*g);e[8]=(d*k-c*l);return e};mat3.determinant=function(h){var d=h[0],c=h[1],b=h[2],k=h[3],j=h[4],i=h[5],g=h[6],f=h[7],e=h[8];return d*(e*j-i*f)+c*(-e*k+i*g)+b*(f*k-j*g)};mat3.multiply=function(o,t,s){var w=t[0],v=t[1],u=t[2],h=t[3],g=t[4],f=t[5],n=t[6],m=t[7],l=t[8],k=s[0],j=s[1],i=s[2],r=s[3],q=s[4],p=s[5],e=s[6],d=s[7],c=s[8];o[0]=k*w+j*h+i*n;o[1]=k*v+j*g+i*m;o[2]=k*u+j*f+i*l;o[3]=r*w+q*h+p*n;o[4]=r*v+q*g+p*m;o[5]=r*u+q*f+p*l;o[6]=e*w+d*h+c*n;o[7]=e*v+d*g+c*m;o[8]=e*u+d*f+c*l;return o};mat3.mul=mat3.multiply;mat3.translate=function(e,k,m){var d=k[0],c=k[1],b=k[2],o=k[3],n=k[4],l=k[5],h=k[6],g=k[7],f=k[8],j=m[0],i=m[1];e[0]=d;e[1]=c;e[2]=b;e[3]=o;e[4]=n;e[5]=l;e[6]=j*d+i*o+h;e[7]=j*c+i*n+g;e[8]=j*b+i*l+f;return e};mat3.rotate=function(f,l,k){var e=l[0],d=l[1],b=l[2],o=l[3],n=l[4],m=l[5],i=l[6],h=l[7],g=l[8],p=Math.sin(k),j=Math.cos(k);f[0]=j*e+p*o;f[1]=j*d+p*n;f[2]=j*b+p*m;f[3]=j*o-p*e;f[4]=j*n-p*d;f[5]=j*m-p*b;f[6]=i;f[7]=h;f[8]=g;return f};mat3.scale=function(e,c,d){var b=d[0],f=d[2];e[0]=b*c[0];e[1]=b*c[1];e[2]=b*c[2];e[3]=f*c[3];e[4]=f*c[4];e[5]=f*c[5];e[6]=c[6];e[7]=c[7];e[8]=c[8];return e};mat3.fromMat2d=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=0;c[3]=b[2];c[4]=b[3];c[5]=0;c[6]=b[4];c[7]=b[5];c[8]=1;return c};mat3.fromQuat=function(m,k){var g=k[0],f=k[1],e=k[2],h=k[3],n=g+g,a=f+f,i=e+e,d=g*n,c=g*a,b=g*i,l=f*a,j=f*i,r=e*i,s=h*n,p=h*a,o=h*i;m[0]=1-(l+r);m[1]=c+o;m[2]=b-p;m[3]=c-o;m[4]=1-(d+r);m[5]=j+s;m[6]=b+p;m[7]=j-s;m[8]=1-(d+l);return m};mat3.str=function(b){return"mat3("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};if(typeof(exports)!=="undefined"){exports.mat3=mat3}var mat4={};var mat4Identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);mat4.create=function(){var a=new GLMAT_ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};mat4.clone=function(b){var c=new GLMAT_ARRAY_TYPE(16);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];c[11]=b[11];c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return c};mat4.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];c[11]=b[11];c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return c};mat4.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};mat4.transpose=function(e,d){if(e===d){var i=d[1],g=d[2],f=d[3],b=d[6],h=d[7],c=d[11];e[1]=d[4];e[2]=d[8];e[3]=d[12];e[4]=i;e[6]=d[9];e[7]=d[13];e[8]=g;e[9]=b;e[11]=d[14];e[12]=f;e[13]=h;e[14]=c}else{e[0]=d[0];e[1]=d[4];e[2]=d[8];e[3]=d[12];e[4]=d[1];e[5]=d[5];e[6]=d[9];e[7]=d[13];e[8]=d[2];e[9]=d[6];e[10]=d[10];e[11]=d[14];e[12]=d[3];e[13]=d[7];e[14]=d[11];e[15]=d[15]}return e};mat4.invert=function(u,z){var D=z[0],B=z[1],A=z[2],x=z[3],f=z[4],e=z[5],d=z[6],c=z[7],t=z[8],s=z[9],r=z[10],q=z[11],F=z[12],E=z[13],C=z[14],y=z[15],p=D*e-B*f,o=D*d-A*f,n=D*c-x*f,m=B*d-A*e,l=B*c-x*e,k=A*c-x*d,j=t*E-s*F,i=t*C-r*F,h=t*y-q*F,g=s*C-r*E,w=s*y-q*E,v=r*y-q*C,b=p*v-o*w+n*g+m*h-l*i+k*j;if(!b){return null}b=1/b;u[0]=(e*v-d*w+c*g)*b;u[1]=(A*w-B*v-x*g)*b;u[2]=(E*k-C*l+y*m)*b;u[3]=(r*l-s*k-q*m)*b;u[4]=(d*h-f*v-c*i)*b;u[5]=(D*v-A*h+x*i)*b;u[6]=(C*n-F*k-y*o)*b;u[7]=(t*k-r*n+q*o)*b;u[8]=(f*w-e*h+c*j)*b;u[9]=(B*h-D*w-x*j)*b;u[10]=(F*l-E*n+y*p)*b;u[11]=(s*n-t*l-q*p)*b;u[12]=(e*i-f*g-d*j)*b;u[13]=(D*g-B*i+A*j)*b;u[14]=(E*o-F*m-C*p)*b;u[15]=(t*m-s*o+r*p)*b;return u};mat4.adjoint=function(j,m){var q=m[0],o=m[1],n=m[2],k=m[3],e=m[4],d=m[5],c=m[6],b=m[7],i=m[8],h=m[9],g=m[10],f=m[11],s=m[12],r=m[13],p=m[14],l=m[15];j[0]=(d*(g*l-f*p)-h*(c*l-b*p)+r*(c*f-b*g));j[1]=-(o*(g*l-f*p)-h*(n*l-k*p)+r*(n*f-k*g));j[2]=(o*(c*l-b*p)-d*(n*l-k*p)+r*(n*b-k*c));j[3]=-(o*(c*f-b*g)-d*(n*f-k*g)+h*(n*b-k*c));j[4]=-(e*(g*l-f*p)-i*(c*l-b*p)+s*(c*f-b*g));j[5]=(q*(g*l-f*p)-i*(n*l-k*p)+s*(n*f-k*g));j[6]=-(q*(c*l-b*p)-e*(n*l-k*p)+s*(n*b-k*c));j[7]=(q*(c*f-b*g)-e*(n*f-k*g)+i*(n*b-k*c));j[8]=(e*(h*l-f*r)-i*(d*l-b*r)+s*(d*f-b*h));j[9]=-(q*(h*l-f*r)-i*(o*l-k*r)+s*(o*f-k*h));j[10]=(q*(d*l-b*r)-e*(o*l-k*r)+s*(o*b-k*d));j[11]=-(q*(d*f-b*h)-e*(o*f-k*h)+i*(o*b-k*d));j[12]=-(e*(h*p-g*r)-i*(d*p-c*r)+s*(d*g-c*h));j[13]=(q*(h*p-g*r)-i*(o*p-n*r)+s*(o*g-n*h));j[14]=-(q*(d*p-c*r)-e*(o*p-n*r)+s*(o*c-n*d));j[15]=(q*(d*g-c*h)-e*(o*g-n*h)+i*(o*c-n*d));return j};mat4.determinant=function(w){var B=w[0],z=w[1],x=w[2],v=w[3],e=w[4],d=w[5],c=w[6],b=w[7],s=w[8],r=w[9],q=w[10],p=w[11],D=w[12],C=w[13],A=w[14],y=w[15],o=B*d-z*e,n=B*c-x*e,m=B*b-v*e,l=z*c-x*d,k=z*b-v*d,j=x*b-v*c,i=s*C-r*D,h=s*A-q*D,g=s*y-p*D,f=r*A-q*C,u=r*y-p*C,t=q*y-p*A;return o*t-n*u+m*f+l*g-k*h+j*i};mat4.multiply=function(o,s,p){var w=s[0],v=s[1],t=s[2],q=s[3],i=s[4],g=s[5],e=s[6],c=s[7],n=s[8],m=s[9],l=s[10],k=s[11],y=s[12],x=s[13],u=s[14],r=s[15];var j=p[0],h=p[1],f=p[2],d=p[3];o[0]=j*w+h*i+f*n+d*y;o[1]=j*v+h*g+f*m+d*x;o[2]=j*t+h*e+f*l+d*u;o[3]=j*q+h*c+f*k+d*r;j=p[4];h=p[5];f=p[6];d=p[7];o[4]=j*w+h*i+f*n+d*y;o[5]=j*v+h*g+f*m+d*x;o[6]=j*t+h*e+f*l+d*u;o[7]=j*q+h*c+f*k+d*r;j=p[8];h=p[9];f=p[10];d=p[11];o[8]=j*w+h*i+f*n+d*y;o[9]=j*v+h*g+f*m+d*x;o[10]=j*t+h*e+f*l+d*u;o[11]=j*q+h*c+f*k+d*r;j=p[12];h=p[13];f=p[14];d=p[15];o[12]=j*w+h*i+f*n+d*y;o[13]=j*v+h*g+f*m+d*x;o[14]=j*t+h*e+f*l+d*u;o[15]=j*q+h*c+f*k+d*r;return o};mat4.mul=mat4.multiply;mat4.translate=function(n,p,i){var h=i[0],g=i[1],f=i[2],s,r,q,o,e,d,c,b,m,l,k,j;if(p===n){n[12]=p[0]*h+p[4]*g+p[8]*f+p[12];n[13]=p[1]*h+p[5]*g+p[9]*f+p[13];n[14]=p[2]*h+p[6]*g+p[10]*f+p[14];n[15]=p[3]*h+p[7]*g+p[11]*f+p[15]}else{s=p[0];r=p[1];q=p[2];o=p[3];e=p[4];d=p[5];c=p[6];b=p[7];m=p[8];l=p[9];k=p[10];j=p[11];n[0]=s;n[1]=r;n[2]=q;n[3]=o;n[4]=e;n[5]=d;n[6]=c;n[7]=b;n[8]=m;n[9]=l;n[10]=k;n[11]=j;n[12]=s*h+e*g+m*f+p[12];n[13]=r*h+d*g+l*f+p[13];n[14]=q*h+c*g+k*f+p[14];n[15]=o*h+b*g+j*f+p[15]}return n};mat4.scale=function(e,c,d){var b=d[0],g=d[1],f=d[2];e[0]=c[0]*b;e[1]=c[1]*b;e[2]=c[2]*b;e[3]=c[3]*b;e[4]=c[4]*g;e[5]=c[5]*g;e[6]=c[6]*g;e[7]=c[7]*g;e[8]=c[8]*f;e[9]=c[9]*f;e[10]=c[10]*f;e[11]=c[11]*f;e[12]=c[12];e[13]=c[13];e[14]=c[14];e[15]=c[15];return e};mat4.rotate=function(B,I,K,b){var m=b[0],l=b[1],k=b[2],C=Math.sqrt(m*m+l*l+k*k),r,G,q,M,L,J,H,j,i,h,g,A,w,v,u,p,o,n,F,E,D,f,e,d;if(Math.abs(C)<GLMAT_EPSILON){return null}C=1/C;m*=C;l*=C;k*=C;r=Math.sin(K);G=Math.cos(K);q=1-G;M=I[0];L=I[1];J=I[2];H=I[3];j=I[4];i=I[5];h=I[6];g=I[7];A=I[8];w=I[9];v=I[10];u=I[11];p=m*m*q+G;o=l*m*q+k*r;n=k*m*q-l*r;F=m*l*q-k*r;E=l*l*q+G;D=k*l*q+m*r;f=m*k*q+l*r;e=l*k*q-m*r;d=k*k*q+G;B[0]=M*p+j*o+A*n;B[1]=L*p+i*o+w*n;B[2]=J*p+h*o+v*n;B[3]=H*p+g*o+u*n;B[4]=M*F+j*E+A*D;B[5]=L*F+i*E+w*D;B[6]=J*F+h*E+v*D;B[7]=H*F+g*E+u*D;B[8]=M*f+j*e+A*d;B[9]=L*f+i*e+w*d;B[10]=J*f+h*e+v*d;B[11]=H*f+g*e+u*d;if(I!==B){B[12]=I[12];B[13]=I[13];B[14]=I[14];B[15]=I[15]}return B};mat4.rotateX=function(b,j,i){var o=Math.sin(i),h=Math.cos(i),n=j[4],m=j[5],l=j[6],k=j[7],g=j[8],f=j[9],e=j[10],d=j[11];if(j!==b){b[0]=j[0];b[1]=j[1];b[2]=j[2];b[3]=j[3];b[12]=j[12];b[13]=j[13];b[14]=j[14];b[15]=j[15]}b[4]=n*h+g*o;b[5]=m*h+f*o;b[6]=l*h+e*o;b[7]=k*h+d*o;b[8]=g*h-n*o;b[9]=f*h-m*o;b[10]=e*h-l*o;b[11]=d*h-k*o;return b};mat4.rotateY=function(g,n,m){var o=Math.sin(m),l=Math.cos(m),f=n[0],e=n[1],d=n[2],b=n[3],k=n[8],j=n[9],i=n[10],h=n[11];if(n!==g){g[4]=n[4];g[5]=n[5];g[6]=n[6];g[7]=n[7];g[12]=n[12];g[13]=n[13];g[14]=n[14];g[15]=n[15]}g[0]=f*l-k*o;g[1]=e*l-j*o;g[2]=d*l-i*o;g[3]=b*l-h*o;g[8]=f*o+k*l;g[9]=e*o+j*l;g[10]=d*o+i*l;g[11]=b*o+h*l;return g};mat4.rotateZ=function(g,j,i){var o=Math.sin(i),h=Math.cos(i),f=j[0],e=j[1],d=j[2],b=j[3],n=j[4],m=j[5],l=j[6],k=j[7];if(j!==g){g[8]=j[8];g[9]=j[9];g[10]=j[10];g[11]=j[11];g[12]=j[12];g[13]=j[13];g[14]=j[14];g[15]=j[15]}g[0]=f*h+n*o;g[1]=e*h+m*o;g[2]=d*h+l*o;g[3]=b*h+k*o;g[4]=n*h-f*o;g[5]=m*h-e*o;g[6]=l*h-d*o;g[7]=k*h-b*o;return g};mat4.fromRotationTranslation=function(n,l,j){var g=l[0],f=l[1],e=l[2],h=l[3],o=g+g,a=f+f,i=e+e,d=g*o,c=g*a,b=g*i,m=f*a,k=f*i,s=e*i,t=h*o,r=h*a,p=h*i;n[0]=1-(m+s);n[1]=c+p;n[2]=b-r;n[3]=0;n[4]=c-p;n[5]=1-(d+s);n[6]=k+t;n[7]=0;n[8]=b+r;n[9]=k-t;n[10]=1-(d+m);n[11]=0;n[12]=j[0];n[13]=j[1];n[14]=j[2];n[15]=1;return n};mat4.fromQuat=function(m,k){var g=k[0],f=k[1],e=k[2],h=k[3],n=g+g,a=f+f,i=e+e,d=g*n,c=g*a,b=g*i,l=f*a,j=f*i,r=e*i,s=h*n,p=h*a,o=h*i;m[0]=1-(l+r);m[1]=c+o;m[2]=b-p;m[3]=0;m[4]=c-o;m[5]=1-(d+r);m[6]=j+s;m[7]=0;m[8]=b+p;m[9]=j-s;m[10]=1-(d+l);m[11]=0;m[12]=0;m[13]=0;m[14]=0;m[15]=1;return m};mat4.frustum=function(e,b,j,a,i,g,f){var h=1/(j-b),d=1/(i-a),c=1/(g-f);e[0]=(g*2)*h;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=(g*2)*d;e[6]=0;e[7]=0;e[8]=(j+b)*h;e[9]=(i+a)*d;e[10]=(f+g)*c;e[11]=-1;e[12]=0;e[13]=0;e[14]=(f*g*2)*c;e[15]=0;return e};mat4.perspective=function(d,c,b,e,a){var h=1/Math.tan(c/2),g=1/(e-a);d[0]=h/b;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=h;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=(a+e)*g;d[11]=-1;d[12]=0;d[13]=0;d[14]=(2*a*e)*g;d[15]=0;return d};mat4.ortho=function(d,b,j,a,h,g,f){var e=1/(b-j),i=1/(a-h),c=1/(g-f);d[0]=-2*e;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=-2*i;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=2*c;d[11]=0;d[12]=(b+j)*e;d[13]=(h+a)*i;d[14]=(f+g)*c;d[15]=1;return d};mat4.lookAt=function(o,v,w,g){var u,t,r,c,b,a,j,i,h,p,s=v[0],q=v[1],n=v[2],f=g[0],e=g[1],d=g[2],m=w[0],l=w[1],k=w[2];if(Math.abs(s-m)<GLMAT_EPSILON&&Math.abs(q-l)<GLMAT_EPSILON&&Math.abs(n-k)<GLMAT_EPSILON){return mat4.identity(o)}j=s-m;i=q-l;h=n-k;p=1/Math.sqrt(j*j+i*i+h*h);j*=p;i*=p;h*=p;u=e*h-d*i;t=d*j-f*h;r=f*i-e*j;p=Math.sqrt(u*u+t*t+r*r);if(!p){u=0;t=0;r=0}else{p=1/p;u*=p;t*=p;r*=p}c=i*r-h*t;b=h*u-j*r;a=j*t-i*u;p=Math.sqrt(c*c+b*b+a*a);if(!p){c=0;b=0;a=0}else{p=1/p;c*=p;b*=p;a*=p}o[0]=u;o[1]=c;o[2]=j;o[3]=0;o[4]=t;o[5]=b;o[6]=i;o[7]=0;o[8]=r;o[9]=a;o[10]=h;o[11]=0;o[12]=-(u*s+t*q+r*n);o[13]=-(c*s+b*q+a*n);o[14]=-(j*s+i*q+h*n);o[15]=1;return o};mat4.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"};if(typeof(exports)!=="undefined"){exports.mat4=mat4}var vec2={};vec2.create=function(){var a=new GLMAT_ARRAY_TYPE(2);a[0]=0;a[1]=0;return a};vec2.clone=function(b){var c=new GLMAT_ARRAY_TYPE(2);c[0]=b[0];c[1]=b[1];return c};vec2.fromValues=function(a,c){var b=new GLMAT_ARRAY_TYPE(2);b[0]=a;b[1]=c;return b};vec2.copy=function(c,b){c[0]=b[0];c[1]=b[1];return c};vec2.set=function(b,a,c){b[0]=a;b[1]=c;return b};vec2.add=function(e,d,c){e[0]=d[0]+c[0];e[1]=d[1]+c[1];return e};vec2.subtract=function(e,d,c){e[0]=d[0]-c[0];e[1]=d[1]-c[1];return e};vec2.sub=vec2.subtract;vec2.multiply=function(e,d,c){e[0]=d[0]*c[0];e[1]=d[1]*c[1];return e};vec2.mul=vec2.multiply;vec2.divide=function(e,d,c){e[0]=d[0]/c[0];e[1]=d[1]/c[1];return e};vec2.div=vec2.divide;vec2.min=function(e,d,c){e[0]=Math.min(d[0],c[0]);e[1]=Math.min(d[1],c[1]);return e};vec2.max=function(e,d,c){e[0]=Math.max(d[0],c[0]);e[1]=Math.max(d[1],c[1]);return e};vec2.scale=function(e,d,c){e[0]=d[0]*c;e[1]=d[1]*c;return e};vec2.distance=function(e,d){var c=d[0]-e[0],f=d[1]-e[1];return Math.sqrt(c*c+f*f)};vec2.dist=vec2.distance;vec2.squaredDistance=function(e,d){var c=d[0]-e[0],f=d[1]-e[1];return c*c+f*f};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(c){var b=c[0],d=c[1];return Math.sqrt(b*b+d*d)};vec2.len=vec2.length;vec2.squaredLength=function(c){var b=c[0],d=c[1];return b*b+d*d};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(c,b){c[0]=-b[0];c[1]=-b[1];return c};vec2.normalize=function(e,d){var c=d[0],f=d[1];var b=c*c+f*f;if(b>0){b=1/Math.sqrt(b);e[0]=d[0]*b;e[1]=d[1]*b}return e};vec2.dot=function(d,c){return d[0]*c[0]+d[1]*c[1]};vec2.cross=function(e,d,c){var f=d[0]*c[1]-d[1]*c[0];e[0]=e[1]=0;e[2]=f;return e};vec2.lerp=function(e,d,c,f){var h=d[0],g=d[1];e[0]=h+f*(c[0]-h);e[1]=g+f*(c[1]-g);return e};vec2.transformMat2=function(e,d,c){var b=d[0],f=d[1];e[0]=c[0]*b+c[2]*f;e[1]=c[1]*b+c[3]*f;return e};vec2.transformMat2d=function(e,d,c){var b=d[0],f=d[1];e[0]=c[0]*b+c[2]*f+c[4];e[1]=c[1]*b+c[3]*f+c[5];return e};vec2.transformMat3=function(e,d,c){var b=d[0],f=d[1];e[0]=c[0]*b+c[3]*f+c[6];e[1]=c[1]*b+c[4]*f+c[7];return e};vec2.transformMat4=function(e,d,c){var b=d[0],f=d[1];e[0]=c[0]*b+c[4]*f+c[12];e[1]=c[1]*b+c[5]*f+c[13];return e};vec2.forEach=(function(){var a=vec2.create();return function(d,h,j,g,f,b){var e,c;if(!h){h=2}if(!j){j=0}if(g){c=Math.min((g*h)+j,d.length)}else{c=d.length}for(e=j;e<c;e+=h){a[0]=d[e];a[1]=d[e+1];f(a,a,b);d[e]=a[0];d[e+1]=a[1]}return d}})();vec2.str=function(b){return"vec2("+b[0]+", "+b[1]+")"};if(typeof(exports)!=="undefined"){exports.vec2=vec2}var vec3={};vec3.create=function(){var a=new GLMAT_ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a};vec3.clone=function(b){var c=new GLMAT_ARRAY_TYPE(3);c[0]=b[0];c[1]=b[1];c[2]=b[2];return c};vec3.fromValues=function(a,d,c){var b=new GLMAT_ARRAY_TYPE(3);b[0]=a;b[1]=d;b[2]=c;return b};vec3.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];return c};vec3.set=function(b,a,d,c){b[0]=a;b[1]=d;b[2]=c;return b};vec3.add=function(e,d,c){e[0]=d[0]+c[0];e[1]=d[1]+c[1];e[2]=d[2]+c[2];return e};vec3.subtract=function(e,d,c){e[0]=d[0]-c[0];e[1]=d[1]-c[1];e[2]=d[2]-c[2];return e};vec3.sub=vec3.subtract;vec3.multiply=function(e,d,c){e[0]=d[0]*c[0];e[1]=d[1]*c[1];e[2]=d[2]*c[2];return e};vec3.mul=vec3.multiply;vec3.divide=function(e,d,c){e[0]=d[0]/c[0];e[1]=d[1]/c[1];e[2]=d[2]/c[2];return e};vec3.div=vec3.divide;vec3.min=function(e,d,c){e[0]=Math.min(d[0],c[0]);e[1]=Math.min(d[1],c[1]);e[2]=Math.min(d[2],c[2]);return e};vec3.max=function(e,d,c){e[0]=Math.max(d[0],c[0]);e[1]=Math.max(d[1],c[1]);e[2]=Math.max(d[2],c[2]);return e};vec3.scale=function(e,d,c){e[0]=d[0]*c;e[1]=d[1]*c;e[2]=d[2]*c;return e};vec3.distance=function(e,d){var c=d[0]-e[0],g=d[1]-e[1],f=d[2]-e[2];return Math.sqrt(c*c+g*g+f*f)};vec3.dist=vec3.distance;vec3.squaredDistance=function(e,d){var c=d[0]-e[0],g=d[1]-e[1],f=d[2]-e[2];return c*c+g*g+f*f};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(c){var b=c[0],e=c[1],d=c[2];return Math.sqrt(b*b+e*e+d*d)};vec3.len=vec3.length;vec3.squaredLength=function(c){var b=c[0],e=c[1],d=c[2];return b*b+e*e+d*d};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(c,b){c[0]=-b[0];c[1]=-b[1];c[2]=-b[2];return c};vec3.normalize=function(e,d){var c=d[0],g=d[1],f=d[2];var b=c*c+g*g+f*f;if(b>0){b=1/Math.sqrt(b);e[0]=d[0]*b;e[1]=d[1]*b;e[2]=d[2]*b}return e};vec3.dot=function(d,c){return d[0]*c[0]+d[1]*c[1]+d[2]*c[2]};vec3.cross=function(d,i,h){var c=i[0],k=i[1],j=i[2],g=h[0],f=h[1],e=h[2];d[0]=k*e-j*f;d[1]=j*g-c*e;d[2]=c*f-k*g;return d};vec3.lerp=function(e,d,c,f){var i=d[0],h=d[1],g=d[2];e[0]=i+f*(c[0]-i);e[1]=h+f*(c[1]-h);e[2]=g+f*(c[2]-g);return e};vec3.transformMat4=function(e,d,c){var b=d[0],g=d[1],f=d[2];e[0]=c[0]*b+c[4]*g+c[8]*f+c[12];e[1]=c[1]*b+c[5]*g+c[9]*f+c[13];e[2]=c[2]*b+c[6]*g+c[10]*f+c[14];return e};vec3.transformQuat=function(h,n,b){var o=n[0],m=n[1],l=n[2],j=b[0],i=b[1],g=b[2],k=b[3],e=k*o+i*l-g*m,d=k*m+g*o-j*l,c=k*l+j*m-i*o,f=-j*o-i*m-g*l;h[0]=e*k+f*-j+d*-g-c*-i;h[1]=d*k+f*-i+c*-j-e*-g;h[2]=c*k+f*-g+e*-i-d*-j;return h};vec3.forEach=(function(){var a=vec3.create();return function(d,h,j,g,f,b){var e,c;if(!h){h=3}if(!j){j=0}if(g){c=Math.min((g*h)+j,d.length)}else{c=d.length}for(e=j;e<c;e+=h){a[0]=d[e];a[1]=d[e+1];a[2]=d[e+2];f(a,a,b);d[e]=a[0];d[e+1]=a[1];d[e+2]=a[2]}return d}})();vec3.str=function(b){return"vec3("+b[0]+", "+b[1]+", "+b[2]+")"};if(typeof(exports)!=="undefined"){exports.vec3=vec3}var vec4={};vec4.create=function(){var a=new GLMAT_ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};vec4.clone=function(b){var c=new GLMAT_ARRAY_TYPE(4);c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];return c};vec4.fromValues=function(a,e,d,b){var c=new GLMAT_ARRAY_TYPE(4);c[0]=a;c[1]=e;c[2]=d;c[3]=b;return c};vec4.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];return c};vec4.set=function(c,a,e,d,b){c[0]=a;c[1]=e;c[2]=d;c[3]=b;return c};vec4.add=function(e,d,c){e[0]=d[0]+c[0];e[1]=d[1]+c[1];e[2]=d[2]+c[2];e[3]=d[3]+c[3];return e};vec4.subtract=function(e,d,c){e[0]=d[0]-c[0];e[1]=d[1]-c[1];e[2]=d[2]-c[2];e[3]=d[3]-c[3];return e};vec4.sub=vec4.subtract;vec4.multiply=function(e,d,c){e[0]=d[0]*c[0];e[1]=d[1]*c[1];e[2]=d[2]*c[2];e[3]=d[3]*c[3];return e};vec4.mul=vec4.multiply;vec4.divide=function(e,d,c){e[0]=d[0]/c[0];e[1]=d[1]/c[1];e[2]=d[2]/c[2];e[3]=d[3]/c[3];return e};vec4.div=vec4.divide;vec4.min=function(e,d,c){e[0]=Math.min(d[0],c[0]);e[1]=Math.min(d[1],c[1]);e[2]=Math.min(d[2],c[2]);e[3]=Math.min(d[3],c[3]);return e};vec4.max=function(e,d,c){e[0]=Math.max(d[0],c[0]);e[1]=Math.max(d[1],c[1]);e[2]=Math.max(d[2],c[2]);e[3]=Math.max(d[3],c[3]);return e};vec4.scale=function(e,d,c){e[0]=d[0]*c;e[1]=d[1]*c;e[2]=d[2]*c;e[3]=d[3]*c;return e};vec4.distance=function(f,d){var c=d[0]-f[0],h=d[1]-f[1],g=d[2]-f[2],e=d[3]-f[3];return Math.sqrt(c*c+h*h+g*g+e*e)};vec4.dist=vec4.distance;vec4.squaredDistance=function(f,d){var c=d[0]-f[0],h=d[1]-f[1],g=d[2]-f[2],e=d[3]-f[3];return c*c+h*h+g*g+e*e};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(d){var b=d[0],f=d[1],e=d[2],c=d[3];return Math.sqrt(b*b+f*f+e*e+c*c)};vec4.len=vec4.length;vec4.squaredLength=function(d){var b=d[0],f=d[1],e=d[2],c=d[3];return b*b+f*f+e*e+c*c};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(c,b){c[0]=-b[0];c[1]=-b[1];c[2]=-b[2];c[3]=-b[3];return c};vec4.normalize=function(f,e){var c=e[0],h=e[1],g=e[2],d=e[3];var b=c*c+h*h+g*g+d*d;if(b>0){b=1/Math.sqrt(b);f[0]=e[0]*b;f[1]=e[1]*b;f[2]=e[2]*b;f[3]=e[3]*b}return f};vec4.dot=function(d,c){return d[0]*c[0]+d[1]*c[1]+d[2]*c[2]+d[3]*c[3]};vec4.lerp=function(e,d,c,f){var i=d[0],h=d[1],g=d[2],j=d[3];e[0]=i+f*(c[0]-i);e[1]=h+f*(c[1]-h);e[2]=g+f*(c[2]-g);e[3]=j+f*(c[3]-j);return e};vec4.transformMat4=function(f,e,c){var b=e[0],h=e[1],g=e[2],d=e[3];f[0]=c[0]*b+c[4]*h+c[8]*g+c[12]*d;f[1]=c[1]*b+c[5]*h+c[9]*g+c[13]*d;f[2]=c[2]*b+c[6]*h+c[10]*g+c[14]*d;f[3]=c[3]*b+c[7]*h+c[11]*g+c[15]*d;return f};vec4.transformQuat=function(h,n,b){var o=n[0],m=n[1],l=n[2],j=b[0],i=b[1],g=b[2],k=b[3],e=k*o+i*l-g*m,d=k*m+g*o-j*l,c=k*l+j*m-i*o,f=-j*o-i*m-g*l;h[0]=e*k+f*-j+d*-g-c*-i;h[1]=d*k+f*-i+c*-j-e*-g;h[2]=c*k+f*-g+e*-i-d*-j;return h};vec4.forEach=(function(){var a=vec4.create();return function(d,h,j,g,f,b){var e,c;if(!h){h=4}if(!j){j=0}if(g){c=Math.min((g*h)+j,d.length)}else{c=d.length}for(e=j;e<c;e+=h){a[0]=d[e];a[1]=d[e+1];a[2]=d[e+2];a[3]=d[e+3];f(a,a,b);d[e]=a[0];d[e+1]=a[1];d[e+2]=a[2];d[e+3]=a[3]}return d}})();vec4.str=function(b){return"vec4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};if(typeof(exports)!=="undefined"){exports.vec4=vec4}var quat={};var quatIdentity=new Float32Array([0,0,0,1]);quat.create=function(){var a=new GLMAT_ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};quat.setAxisAngle=function(b,d,a){a=a*0.5;var c=Math.sin(a);b[0]=c*d[0];b[1]=c*d[1];b[2]=c*d[2];b[3]=Math.cos(a);return b};quat.add=vec4.add;quat.multiply=function(e,k,j){var c=k[0],m=k[1],l=k[2],d=k[3],h=j[0],g=j[1],f=j[2],i=j[3];e[0]=c*i+d*h+m*f-l*g;e[1]=m*i+d*g+l*h-c*f;e[2]=l*i+d*f+c*g-m*h;e[3]=d*i-c*h-m*g-l*f;return e};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(d,h,f){f*=0.5;var b=h[0],j=h[1],i=h[2],c=h[3],e=Math.sin(f),g=Math.cos(f);d[0]=b*g+c*e;d[1]=j*g+i*e;d[2]=i*g-j*e;d[3]=c*g-b*e;return d};quat.rotateY=function(d,h,f){f*=0.5;var b=h[0],j=h[1],i=h[2],c=h[3],e=Math.sin(f),g=Math.cos(f);d[0]=b*g-i*e;d[1]=j*g+c*e;d[2]=i*g+b*e;d[3]=c*g-j*e;return d};quat.rotateZ=function(d,h,f){f*=0.5;var b=h[0],j=h[1],i=h[2],c=h[3],e=Math.sin(f),g=Math.cos(f);d[0]=b*g+j*e;d[1]=j*g-b*e;d[2]=i*g+c*e;d[3]=c*g-i*e;return d};quat.calculateW=function(d,c){var b=c[0],f=c[1],e=c[2];d[0]=b;d[1]=f;d[2]=e;d[3]=-Math.sqrt(Math.abs(1-b*b-f*f-e*e));return d};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(g,p,o,r){var c=p[0],s=p[1],q=p[2],d=p[3],m=o[0],l=o[1],j=o[2],n=o[3];var f=c*m+s*l+q*j+d*n,h,e,k,i;if(Math.abs(f)>=1){if(g!==p){g[0]=c;g[1]=s;g[2]=q;g[3]=d}return g}h=Math.acos(f);e=Math.sqrt(1-f*f);if(Math.abs(e)<0.001){g[0]=(c*0.5+m*0.5);g[1]=(s*0.5+l*0.5);g[2]=(q*0.5+j*0.5);g[3]=(d*0.5+n*0.5);return g}k=Math.sin((1-r)*h)/e;i=Math.sin(r*h)/e;g[0]=(c*k+m*i);g[1]=(s*k+l*i);g[2]=(q*k+j*i);g[3]=(d*k+n*i);return g};quat.invert=function(h,d){var f=d[0],c=d[1],b=d[2],i=d[3],e=f*f+c*c+b*b+i*i,g=e?1/e:0;h[0]=-f*g;h[1]=-c*g;h[2]=-b*g;h[3]=i*g;return h};quat.conjugate=function(c,b){c[0]=-b[0];c[1]=-b[1];c[2]=-b[2];c[3]=b[3];return c};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=(function(){var a=[1,2,0];return function(f,b){var c=b[0]+b[4]+b[8];var h;if(c>0){h=Math.sqrt(c+1);f[3]=0.5*h;h=0.5/h;f[0]=(b[7]-b[5])*h;f[1]=(b[2]-b[6])*h;f[2]=(b[3]-b[1])*h}else{var g=0;if(b[4]>b[0]){g=1}if(b[8]>b[g*3+g]){g=2}var e=a[g];var d=a[e];h=Math.sqrt(b[g*3+g]-b[e*3+e]-b[d*3+d]+1);f[g]=0.5*h;h=0.5/h;f[3]=(b[d*3+e]-b[e*3+d])*h;f[e]=(b[e*3+g]+b[g*3+e])*h;f[d]=(b[d*3+g]+b[g*3+d])*h}return f}})();quat.str=function(b){return"quat("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};if(typeof(exports)!=="undefined"){exports.quat=quat}(function(a){a.Color=function(f,e,c){var d=this;d.r=undefined===f?0:f;d.g=undefined===e?0:e;d.b=undefined===c?0:c;return d};a.Color.prototype={constructor:a.Color,multiply:function(b){return new a.Color(b.r*this.r,b.g*this.g,b.b*this.b)}}})(this);(function(c){var d={name:"color-shader-vs",type:"x-shader/x-vertex",body:"precision highp float;uniform mat4 uProjectionMatrix;uniform mat4 uModelViewMatrix;uniform vec4 uColor;uniform float uDepth;attribute vec2 aPosition;attribute vec4 aColor;varying vec4 vColor;void main(void) {gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, uDepth, 1.0);vColor = uColor * aColor;}"};var j={name:"color-shader-fs",type:"x-shader/x-fragment",body:"precision highp float;varying vec4 vColor;void main(void) {gl_FragColor = vColor;}"};var f={name:"texture-shader-vs",type:"x-shader/x-vertex",body:"precision highp float;uniform mat4 uProjectionMatrix;uniform mat4 uModelViewMatrix;uniform vec4 uColor;uniform float uDepth;attribute vec2 aPosition;attribute vec2 aUV;attribute vec4 aColor;varying vec4 vColor;varying vec2 vUV;void main(void) {gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, uDepth, 1.0);vColor = aColor * uColor;vUV = aUV;}"};var k={name:"texture-shader-fs",type:"x-shader/x-fragment",body:"precision highp float;varying vec4 vColor;varying vec2 vUV;uniform sampler2D uMainTextureSampler;void main(void) {gl_FragColor = texture2D(uMainTextureSampler, vUV) * vColor;}"};var i={name:"ss-shader-vs",type:"x-shader/x-vertex",body:"precision highp float;uniform mat4 uProjectionMatrix;uniform mat4 uModelViewMatrix;uniform vec4 uColor;uniform float uDepth;attribute vec2 aPosition;attribute vec2 aUV;attribute vec4 aColor;varying vec4 vColor;varying vec4 vVertexColor;varying vec2 vUV;void main(void) {gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, uDepth, 1.0);vColor = uColor;vUV = aUV;vVertexColor = aColor;}"};var e={name:"ss-shader-fs",type:"x-shader/x-fragment",body:"precision highp float;varying vec4 vColor;varying vec4 vVertexColor;varying vec2 vUV;uniform sampler2D uMainTextureSampler;uniform float uFutureBlendScalar;void main(void) {vec4 currentFrame = texture2D(uMainTextureSampler, vUV);vec4 futureFrame = texture2D(uMainTextureSampler, vec2(vVertexColor.xy));gl_FragColor = futureFrame * uFutureBlendScalar + currentFrame * (1.0 - uFutureBlendScalar);}"};var h={name:"bb-shader-vs",type:"x-shader/x-vertex",body:"precision highp float;uniform mat4 uProjectionMatrix;uniform mat4 uModelViewMatrix;attribute vec2 aPosition;attribute vec2 aUV;varying vec2 vUV;void main(void) {gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, 0.0, 1.0);vUV = aUV;}"};var b={name:"bb-shader-fs",type:"x-shader/x-fragment",body:"varying vec2 vUV;void main(void) {gl_FragColor = vec4(1.0, 0.0, 0.0, 0.2);}"};var g={name:"particle-shader-vs",type:"x-shader/x-vertex",body:"precision highp float;uniform mat4 uProjectionMatrix;uniform mat4 uModelViewMatrix;uniform vec4 uColor;uniform float uDepth;attribute vec2 aPosition;attribute vec2 aUV;attribute vec4 aColor;varying vec4 vColor;varying vec2 vUV;void main(void) {gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, uDepth, 1.0);vColor = aColor * uColor;vUV = aUV;}"};var a={name:"particle-shader-fs",type:"x-shader/x-fragment",body:"precision highp float;varying vec4 vColor;varying vec2 vUV;uniform sampler2D uMainTextureSampler;void main(void) {gl_FragColor = texture2D(uMainTextureSampler, vUV) * vColor;}"};c.__DEFAULT_SHADERS=[d,j,f,k,e,i,h,b,g,a]})(this);window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var Log=(function(){function b(d){if(console&&console.log){console.log(d)}}function c(j,h){var f=[];var g=j.split(/\{\}/);for(var e=0,d=Math.min(h.length,g.length);e<d;e++){f.push(g[e]);f.push(h[e])}if(e<g.length){f.push(g.slice(e).join(""))}return f.join("")}function a(d){return function(){var e=Array.prototype.slice.call(arguments);if(0===e.length){return}else{if(1===e.length){b("["+d+"] : "+e[0])}else{b("["+d+"] : "+c(e[0],e.slice(1)))}}}}return{debug:a("Debug"),info:a("Info"),warn:a("Warn"),error:a("Error")}})();var Signal=signals.Signal;var Engine=(function(){return function(){var d=this;var a=new Scene();d.paused=false;d.onPreUpdate=new Signal();d.onPostUpdate=new Signal();var c=false,f=null,b=0,e=0;d.getSimulationTime=function(){return e};d.getRenderer=function(){return f};d.getScene=function(){return a};d.initialize=function(i){if(true===c){throw new Error("Cannot initialize Engine twice!")}c=true;f=i;b=Date.now();window.requestAnimationFrame(function h(){var j=Date.now();var k=j-b;b=j;g(k);window.requestAnimationFrame(h)})};function g(h){if(d.paused){return}e+=h;f.preUpdate();d.onPreUpdate.dispatch(h);a.update(h,f);d.onPostUpdate.dispatch(h)}return d}})();Engine.prototype={constructor:Engine};(function(a){a.Function.prototype.curry=function(){var c=Array.prototype.slice.call(arguments);if(c.length<1){return this}var b=this;return function(){return b.apply(this,c.concat(Array.prototype.slice.call(arguments)))}}})(this);(function(b){var c=0;var a=function(){var e=this;var d=c++;e.getId=function(){return d};e.shader=new Shader();e.mainTexture=new Texture();e.secTexture=new Texture();return e};a.prototype={constructor:a,prepareTextures:function(d){if(null!==this.mainTexture){this.mainTexture.prepareTexture(d)}if(null!==this.secTexture){this.secTexture.prepareTexture(d)}},pushTextures:function(d,e){if(null!==this.mainTexture){this.mainTexture.pushTexture(d,e,d.TEXTURE0)}if(null!==this.secTexture){this.secTexture.pushTexture(d,e,d.TEXTURE1)}}};b.Material=a})(this);(function(c){var b=vec3.create();var a=function(d,i,e,g){var f=this;f.x=undefined===d?0:d;f.y=undefined===i?0:i;f.w=undefined===e?0:e;f.h=undefined===g?0:g;return f};a.prototype={constructor:a,zero:function(){this.x=this.y=this.w=this.h=0},set:function(d,g,e,f){this.x=d;this.y=g;this.w=e;this.h=f},copy:function(d){this.x=d.x;this.y=d.y;this.w=d.w;this.h=d.h}};c.Rectangle=a})(this);(function(){Math.clamp=function(c,b,a){return c<b?b:c>a?a:c}})();(function(a){var b=function(){var c=this;c.width=1;c.height=1;c.vertices=new Float32Array([0,0,0,1,1,0,1,1]);c.uvs=new Float32Array([0,0,0,1,1,0,1,1]);c.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);c.vertexBuffer=null;c.uvBuffer=null;c.colorBuffer=null;c.__apply=true;return c};b.prototype={constructor:b,apply:function(){this.vertices[4]=this.vertices[6]=this.width;this.vertices[3]=this.vertices[7]=this.height;this.__apply=true},clearBuffers:function(){this.vertexBuffer=this.uvBuffer=this.colorBuffer=null},prepareBuffers:function(c){if(null===this.vertexBuffer){this.vertexBuffer=c.createBuffer()}if(null===this.uvBuffer){this.uvBuffer=c.createBuffer()}if(null===this.colorBuffer){this.colorBuffer=c.createBuffer()}if(this.__apply){c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertices,c.STATIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.bufferData(c.ARRAY_BUFFER,this.uvs,c.STATIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.bufferData(c.ARRAY_BUFFER,this.colors,c.STATIC_DRAW)}this.__apply=false},pushBuffers:function(c,d){if(-1<d.vertexBufferAttributePointer){c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.vertexAttribPointer(d.vertexBufferAttributePointer,2,c.FLOAT,false,0,0)}if(-1<d.uvBufferAttributePointer){c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.vertexAttribPointer(d.uvBufferAttributePointer,2,c.FLOAT,false,0,0)}if(-1<d.vertexColorBufferAttributePointer){c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.vertexAttribPointer(d.vertexColorBufferAttributePointer,4,c.FLOAT,false,0,0)}},draw:function(c){c.drawArrays(c.TRIANGLE_STRIP,0,4)}};a.Quad=b})(this);(function(b){var a=0.0001;var c=function(f){var e=this;var g=f;var d=[];e.getMaterial=function(){return g};e.getDisplayObjects=function(){return d};e.addDisplayObject=function(h){if(h.material!==g){return false}if(!c.canBatch(h)){return false}h.alpha=1;d.push(h)};e.removeDisplayObject=function(i){var h=d.indexOf(i);if(-1!==h){d.splice(h,1)}};return e};c.canBatch=function(d){if(Math.abs(1-d.alpha)>a){return false}return true};c.prototype={constructor:c};b.RenderBatch=c})(this);(function(e){var d=signals.Signal;var c=0,b;var a=function(){var f=this;f.autoBatch=false;f.root=new DisplayObject();f.root._parent=f.root;f.showBoundingBoxes=false;f.update=function(m,n){var l=[],o={};g(this.root,l,o,0,100);var k=n.getContext();k.enable(k.DEPTH_TEST);for(var p in o){n.drawBatch(o[p])}k.disable(k.DEPTH_TEST);for(var j=0,h=l.length;j<h;j++){n.drawDisplayObject(l[j])}if(f.showBoundingBoxes){for(j=0;j<h;j++){n.drawBoundingBox(l[j])}}};function g(k,r,m,p,t){var j=k._children;var q=j.length;if(0===q){return}var u=(t-p)/q;var l=u/10;var s=9*u/10;for(var o=0;o<q;o++){var h=j[o];if(!h.visible){continue}h.__depth=p+u*o;if(f.autoBatch&&RenderBatch.canBatch(h)){var n=m[h.material.getId()];if(undefined===n){n=m[h.material.getId()]=new RenderBatch(h.material)}n.addDisplayObject(h)}else{r.push(h)}g(h,r,m,h.__depth+l,h.__depth+s)}}return f};a.prototype={constructor:a};e.Scene=a})(this);var Shader=(function(){var a={FLOAT:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6};return function(){var j=this;j.vertexBufferAttributePointer=null;j.vertexColorBufferAttributePointer=null;j.uvBufferAttributePointer=null;j.projectionMatrixUniformPointer=null;j.modelMatrixUniformPointer=null;j.colorUniformPointer=null;j.depthUniformPointer=null;j.mainTextureUniformPointer=null;j.secTextureUniformPointer=null;var l=false,h=true,i=null,d="texture-shader-vs",g="texture-shader-fs",c={};j.setShaderProgramIds=function(p,o){if(p===d&&o===g){return}d=p;g=o;l=false};j.getShaderProgram=function(){return i};function m(o){return function(p,q){if(undefined===c[p]){c[p]={type:o,pointer:-1,value:q};h=true}else{c[p].value=q}}}j.setUniformFloat=m(a.FLOAT);j.setUniformVec2=m(a.VEC2);j.setUniformVec3=m(a.VEC3);j.setUniformVec4=m(a.VEC4);j.setUniformMat2=m(a.MAT2);j.setUniformMat3=m(a.MAT3);j.setUniformMat4=m(a.MAT4);j.compile=function(p){if(!l){if(null===d||null===g){return false}if(window.isTwoDeeDebug){Log.debug("Compiling program {"+d+" :: "+g+"}")}var o=b(p,g);var r=b(p,d);i=p.createProgram();if(null===r||null===o){return false}try{p.attachShader(i,r);p.attachShader(i,o)}catch(q){return false}p.linkProgram(i);if(!p.getProgramParameter(i,p.LINK_STATUS)){return false}l=true}if(h){n(p);h=true}return true};j.pushCustomUniforms=function(o){Object.keys(c).forEach(function(p){var q=c[p];if(-1===q.pointer){return}switch(q.type){case a.FLOAT:o.uniform1f(q.pointer,q.value);break;case a.VEC2:o.uniform2fv(q.pointer,q.value);break;case a.VEC3:o.uniform3fv(q.pointer,q.value);break;case a.VEC4:o.uniform4fv(q.pointer,q.value);break;case a.MAT2:o.uniformMatrix2fv(q.pointer,false,q.value);break;case a.MAT3:o.uniformMatrix3fv(q.pointer,false,q.value);break;case a.MAT4:o.uniformMatrix4fv(q.pointer,false,q.value);break}})};function b(o,t){var p=document.getElementById(t);if(null===p){Log.error("Could not find shader "+t+".");return null}var r="";var s=p.firstChild;while(s){if(s.nodeType===s.TEXT_NODE){r+=s.textContent}s=s.nextSibling}var q=null;if("x-shader/x-fragment"===p.type){q=o.createShader(o.FRAGMENT_SHADER)}else{if("x-shader/x-vertex"===p.type){q=o.createShader(o.VERTEX_SHADER)}else{Log.error("Unknown shader type : "+p.type);return null}}o.shaderSource(q,r);o.compileShader(q);if(!o.getShaderParameter(q,o.COMPILE_STATUS)){if(window.isTwoDeeDebug){Log.error("Could not compile shader :\n{}",o.getShaderInfoLog(q))}return null}return q}function n(o){k(o);f(o);e(o)}function k(o){j.vertexBufferAttributePointer=o.getAttribLocation(i,"aPosition");if(-1!==j.vertexBufferAttributePointer){o.enableVertexAttribArray(j.vertexBufferAttributePointer)}j.vertexColorBufferAttributePointer=o.getAttribLocation(i,"aColor");if(-1!==j.vertexColorBufferAttributePointer){o.enableVertexAttribArray(j.vertexColorBufferAttributePointer)}j.uvBufferAttributePointer=o.getAttribLocation(i,"aUV");if(-1!==j.uvBufferAttributePointer){o.enableVertexAttribArray(j.uvBufferAttributePointer)}}function f(o){j.projectionMatrixUniformPointer=o.getUniformLocation(i,"uProjectionMatrix");j.modelMatrixUniformPointer=o.getUniformLocation(i,"uModelViewMatrix");j.colorUniformPointer=o.getUniformLocation(i,"uColor");j.depthUniformPointer=o.getUniformLocation(i,"uDepth");j.mainTextureUniformPointer=o.getUniformLocation(i,"uMainTextureSampler");j.secTextureUniformPointer=o.getUniformLocation(i,"uSecTextureSampler")}function e(o){Object.keys(c).forEach(function(p){var q=c[p];q.pointer=o.getUniformLocation(i,p)})}return j}})();(function(b){var a=function(){var c=this;var d=new Set();c.addSpriteSheet=function(e){d.add(e)};c.removeSpriteSheet=function(e){d.remove(e)};c.onPreUpdate=function(g){var h=d.getElements();for(var f=0,e=h.length;f<e;f++){h[f].update(g)}};return c};a.prototype={constructor:a};b.SpriteSheetScheduler=a})(this);(function(b){var a=function(d){var c=this;c.image=undefined===d?null:d;c.glTexture=null;c.flipY=false;c.filterLinear=true;c.mipmapLinear=true;return c};a.prototype={constructor:a,getWidth:function(){return this.image?parseInt(this.image.width,10):0},getHeight:function(){return this.image?parseInt(this.image.height,10):0},prepareTexture:function(c){if(null===this.image){return}if(null===this.glTexture){this.glTexture=c.createTexture();c.bindTexture(c.TEXTURE_2D,this.glTexture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,this.flipY);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,this.image);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,this.filterLinear?c.LINEAR:c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.filterLinear?c.LINEAR:c.NEAREST);c.bindTexture(c.TEXTURE_2D,null)}},pushTexture:function(c,e,d){if(-1===e.mainTextureUniformPointer){return}c.activeTexture(d);c.bindTexture(c.TEXTURE_2D,this.glTexture);c.uniform1i(e.mainTextureUniformPointer,0)}};b.Texture=a})(this);(function(c){var b=vec3.create();var a=function(){var d=this;var e=mat4.create();d.anchorPoint={x:0,y:0};d.position={x:0,y:0};d.rotationInRadians=0;d.scale={x:1,y:1};d.getMatrix=function(){return e};d.recalculateMatrix=function(){mat4.identity(e);mat4.translate(e,e,vec3.set(b,d.position.x,d.position.y,0));mat4.rotateZ(e,e,d.rotationInRadians);mat4.translate(e,e,vec3.set(b,-d.anchorPoint.x,-d.anchorPoint.y,0));mat4.scale(e,e,vec3.set(b,d.scale.x,d.scale.y,1));return e};return d};a.prototype={constructor:a,clone:function(){var d=new a();d.copy(this);return d},copy:function(d){this.position.x=d.position.x;this.position.y=d.position.y;this.scale.x=d.scale.x;this.scale.y=d.scale.y;this.rotationInRadians=d.rotationInRadians}};c.Transform=a})(this);(function(d){var c=mat4.create(),e=new Float32Array([1,1,1,1]);var a=function(i){var j=this;var k=i,f,h={};j.getCanvas=function(){return k};j.getContext=function(){return f};j.resize=(function(){var m=0;var n=0;return function(){var p=i.clientWidth;var o=i.clientHeight;if(p===m&&o===n){return}i.width=p;i.height=o;f.viewport(0,0,f.drawingBufferWidth,f.drawingBufferHeight);j.projectionMatrix=mat4.ortho(mat4.create(),0,p,o,-1,1)}})();try{var l={premultipliedAlpha:false,alpha:false};f=i.getContext("webgl",l)||i.getContext("experimental-webgl",l);j.resize();if(window.isTwoDeeDebug){f=WebGLDebugUtils.makeDebugContext(f);h.isDebugCanvas=true}f.clearColor(1,1,1,1);f.enable(f.BLEND);f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA)}catch(g){Log.error(g)}if(d.__DEFAULT_SHADERS){d.__DEFAULT_SHADERS.forEach(this.appendShader)}return j};a.prototype={constructor:a,getWidth:function(){return this.getCanvas().clientWidth},getHeight:function(){return this.getCanvas().clientHeight},appendShader:function(g){var h=document.createElement("script");h.type=g.type;h.id=g.name;try{h.appendChild(document.createTextNode(g.body))}catch(f){h.text=g.body}finally{document.body.appendChild(h)}},preUpdate:function(){this.resize();var f=this.getContext();f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT)},drawBatch:function(k){var j=this.getContext();var m=k.getMaterial().shader;m.compile(j);j.useProgram(m.getShaderProgram());m.pushCustomUniforms(j);if(-1!==m.projectionMatrixUniformPointer){j.uniformMatrix4fv(m.projectionMatrixUniformPointer,false,this.projectionMatrix)}k.getMaterial().prepareTextures(j);k.getMaterial().pushTextures(j,m);var g=k.getDisplayObjects();for(var h=0,f=g.length;h<f;h++){var n=g[h];if(-1!==m.depthUniformPointer){j.uniform1f(m.depthUniformPointer,n.__depth)}if(-1!==m.modelMatrixUniformPointer){j.uniformMatrix4fv(m.modelMatrixUniformPointer,false,n.recalculateWorldMatrix(c))}if(-1!==m.colorUniformPointer){var l=n.tint;e[0]=l.r;e[1]=l.g;e[2]=l.b;e[3]=n.alpha;j.uniform4fv(m.colorUniformPointer,e)}n.geometry.prepareBuffers(j);n.geometry.pushBuffers(j,m);n.geometry.draw(j)}},drawDisplayObject:function(h){var f=this.getContext();var g=h.material.shader;g.compile(f);f.useProgram(g.getShaderProgram());g.pushCustomUniforms(f);if(-1!==g.projectionMatrixUniformPointer){f.uniformMatrix4fv(g.projectionMatrixUniformPointer,false,this.projectionMatrix)}if(-1!==g.depthUniformPointer){f.uniform1f(g.depthUniformPointer,h.__depth)}if(-1!==g.modelMatrixUniformPointer){f.uniformMatrix4fv(g.modelMatrixUniformPointer,false,h.recalculateWorldMatrix())}if(-1!==g.colorUniformPointer){e[0]=e[1]=e[2]=e[3]=1;f.uniform4fv(g.colorUniformPointer,b(h,e))}h.material.prepareTextures(f);h.material.pushTextures(f,g);h.geometry.prepareBuffers(f);h.geometry.pushBuffers(f,g);h.geometry.draw(f)},drawBoundingBox:(function(){var f=null;return function(h){var g=this.getContext();if(null===f){f=new Shader();f.setShaderProgramIds("bb-shader-vs","bb-shader-fs");f.compile(g)}g.useProgram(f.getShaderProgram());if(-1!==f.projectionMatrixUniformPointer){g.uniformMatrix4fv(shader.projectionMatrixUniformPointer,false,this.projectionMatrix)}if(-1!==f.modelMatrixUniformPointer){g.uniformMatrix4fv(shader.modelMatrixUniformPointer,false,h.recalculateWorldMatrix())}h.quad.prepareBuffers(g);h.quad.pushBuffers(g,shader)}})()};function b(g,f){if(g._parent&&g._parent!==g){b(g._parent,f)}f[0]*=g.tint.r;f[1]*=g.tint.g;f[2]*=g.tint.b;f[3]*=g.alpha;return f}d.WebGLRenderer=a})(this);(function(a){a.AnimationCurveKey=function(d,c){var b=this;b.time=Math.clamp(undefined===d?0:d,0,1);b.value=Math.clamp(undefined===c?1:c,0,1);return b};a.AnimationCurveKey.prototype={constructor:a.AnimationCurveKey};a.AnimationCurve=function(e){var d=this;var c=[new a.AnimationCurveKey(0,0),new a.AnimationCurveKey(1,1)];d.easingFunction=Easing.Quadratic.InOut;d.getKeys=function(){return c.slice(0)};d.getFirstKey=function(){return 0!==c.length?c[0]:null};d.getLastKey=function(){if(c.length>0){return c[c.length-1]}return null};d.addKey=function(h){for(var g=0,f=c.length-1;g<f;g++){if(c[g].time<h.time&&c[g+1].time>h.time){c.splice(g+1,0,h);return}}c.push(h);return h};d.removeKey=function(g){var f=c.indexOf(g);if(-1!==f){c.splice(f,1)}};d.evaluate=function(k){k=Math.clamp(k,0,1);var g=c.length;if(g<2){return 0}var h,f;for(var j=0;j<g-1;j++){h=c[j];f=c[j+1];if(h.time<=k&&f.time>=k){return b(h.value,f.value,(k-h.time)/(f.time-h.time))}}return c[g-1].value};function b(g,f,h){return g+d.easingFunction(h)*(f-g)}return d};a.AnimationCurve.prototype={constructor:a.AnimationCurve}})(this);(function(a){a.Easing={Linear:{None:function(b){return b}},Quadratic:{In:function(b){return b*b},Out:function(b){return b*(2-b)},InOut:function(b){if((b*=2)<1){return 0.5*b*b}return -0.5*(--b*(b-2)-1)}},Cubic:{In:function(b){return b*b*b},Out:function(b){return --b*b*b+1},InOut:function(b){if((b*=2)<1){return 0.5*b*b*b}return 0.5*((b-=2)*b*b+2)}},Quartic:{In:function(b){return b*b*b*b},Out:function(b){return 1-(--b*b*b*b)},InOut:function(b){if((b*=2)<1){return 0.5*b*b*b*b}return -0.5*((b-=2)*b*b*b-2)}},Quintic:{In:function(b){return b*b*b*b*b},Out:function(b){return --b*b*b*b*b+1},InOut:function(b){if((b*=2)<1){return 0.5*b*b*b*b*b}return 0.5*((b-=2)*b*b*b*b+2)}},Sinusoidal:{In:function(b){return 1-Math.cos(b*Math.PI/2)},Out:function(b){return Math.sin(b*Math.PI/2)},InOut:function(b){return 0.5*(1-Math.cos(Math.PI*b))}},Exponential:{In:function(b){return b===0?0:Math.pow(1024,b-1)},Out:function(b){return b===1?1:1-Math.pow(2,-10*b)},InOut:function(b){if(b===0){return 0}if(b===1){return 1}if((b*=2)<1){return 0.5*Math.pow(1024,b-1)}return 0.5*(-Math.pow(2,-10*(b-1))+2)}},Circular:{In:function(b){return 1-Math.sqrt(1-b*b)},Out:function(b){return Math.sqrt(1-(--b*b))},InOut:function(b){if((b*=2)<1){return -0.5*(Math.sqrt(1-b*b)-1)}return 0.5*(Math.sqrt(1-(b-=2)*b)+1)}},Elastic:{In:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}return -(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))},Out:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}return(b*Math.pow(2,-10*c)*Math.sin((c-d)*(2*Math.PI)/e)+1)},InOut:function(c){var d,b=0.1,e=0.4;if(c===0){return 0}if(c===1){return 1}if(!b||b<1){b=1;d=e/4}else{d=e*Math.asin(1/b)/(2*Math.PI)}if((c*=2)<1){return -0.5*(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))}return b*Math.pow(2,-10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e)*0.5+1}},Back:{In:function(b){var c=1.70158;return b*b*((c+1)*b-c)},Out:function(b){var c=1.70158;return --b*b*((c+1)*b+c)+1},InOut:function(b){var c=1.70158*1.525;if((b*=2)<1){return 0.5*(b*b*((c+1)*b-c))}return 0.5*((b-=2)*b*((c+1)*b+c)+2)}},Bounce:{In:function(b){return 1-TWEEN.Easing.Bounce.Out(1-b)},Out:function(b){if(b<(1/2.75)){return 7.5625*b*b}else{if(b<(2/2.75)){return 7.5625*(b-=(1.5/2.75))*b+0.75}else{if(b<(2.5/2.75)){return 7.5625*(b-=(2.25/2.75))*b+0.9375}else{return 7.5625*(b-=(2.625/2.75))*b+0.984375}}}},InOut:function(b){if(b<0.5){return TWEEN.Easing.Bounce.In(b*2)*0.5}return TWEEN.Easing.Bounce.Out(b*2-1)*0.5+0.5}}}})(this);(function(b){var a=0;b.ObjectPool=function(l,f,h,c){var j=this,g="__pool"+(++a),k=[l],d=[l];for(var e=0;e<l;e++){d[e]=e;k[e]=f();k[e][g]=e}j.get=function(){if(d.length>0){var m=d.pop();var i=k[m];i[g]=m;if(undefined!==h){h(i)}return i}return null};j.put=function(i){if(undefined===i[g]){return}d.push(i[g]);if(undefined!==c){c(i)}};return j}})(this);(function(a){var b=0;a.Set=function(){var c=this;var d="__set"+(++b),e=[];c.add=function(f){if(!f){return}c.remove(f);f[d]=e.length;e.push(f);return f};c.remove=function(g){if(!g){return}if(undefined===g[d]){return}if(e.length>1){var f=g[d];if(f===e.length-1){e.pop()}else{e[f]=e.pop();e[f][d]=f}delete g[d]}else{e.pop()}return g};c.getElements=function(){return[].concat(e)};return c};a.Set.prototype={constructor:a.Set}})(this);(function(c){var b=signals.Signal;var d=0,a=vec3.create();c.DisplayObject=function(h){var g=this;var f=d++,i=new Rectangle(0,0,0,0),e=new Rectangle(0,0,0,0);g._worldMatrix=mat4.create();if(undefined===h){h={}}g.visible=false===h.visible?false:true;g.alpha=undefined===h.alpha?1:h.alpha;g.tint=undefined===h.tint?new Color(1,1,1):h.tint;g.transform=new Transform();g.transform.position.x=undefined===h.x?0:h.x;g.transform.position.y=undefined===h.y?0:h.y;g.material=undefined===h.material?new Material():h.material;if(undefined!==h.mainTexture){g.material.mainTexture=h.mainTexture}if(undefined!==h.secTexture){g.material.secTexture=h.secTexture}g.geometry=new Quad();g.geometry.width=undefined===h.width?1:h.width;g.geometry.height=undefined===h.height?1:h.height;g.geometry.apply();g._children=[];g._parent=null;g.getWidth=function(){return g.geometry.width};g.getHeight=function(){return g.geometry.height};g.recalculateWorldMatrix=(function(){function k(m,l){if(null!==m._parent&&m._parent!==m){k(m._parent,l)}mat4.multiply(l,l,m.transform.recalculateMatrix())}function j(m,l){mat4.identity(l);if(null!==m._parent&&m._parent!==m){k(m._parent,l)}mat4.multiply(l,l,m.transform.recalculateMatrix());return l}return function(){return j(g,g._worldMatrix)}})();g.getUniqueId=function(){return f};g.getLocalBB=function(){var k=g.transform.position.x;var m=g.transform.position.y;var l=g.geometry.width;var j=g.geometry.height;i.set(k,m,k+l,m+j);return i};g.getWorldBB=function(){var n=this;var m=n.getLocalAABB();var l=n.recalculateWorldMatrix();vec3.transformMat4(a,vec3.set(a,m.x,m.y,0),l);var k=a[0];var j=a[1];vec3.transformMat4(a,vec3.set(a,this.x+this.w,this.y+this.h,0),l);e.set(k,j,a[0]-k,a[1]-j);return e};return g};c.DisplayObject.prototype={constructor:c.DisplayObject,getParent:function(){return this._parent},getChildren:function(){return this._children.slice(0)},addChild:function(e){if(this===e){throw new Error("Cannot add self to self.")}if(e._parent===e){throw new Error("Cannot add root to another DisplayObject.")}if(e._parent===this){return}if(e._parent){e._parent.removeChild(e)}e._parent=this;this._children.push(e);if(null!==this.getParent()){c.SceneManager.__addDisplayObject(e)}return e},addChildren:function(e){e.forEach(this.addChild)},removeChild:function(f){var e=this._children.indexOf(f);if(-1!==e){this._children.splice(e,1);f._parent=null;c.SceneManager.__removeDisplayObject(f)}return f},removeChildren:function(e){e.forEach(this.removeChild)},removeFromParent:function(){if(this._parent){this._parent.removeChild(this)}},removeAllChildren:function(){var g=this._children.slice(0);for(var f=0,e=g;f<e;f++){this.removeChild(g[f])}}}})(this);(function(b){var a={};b.SceneManager={__addDisplayObject:function(c){a[c.getUniqueId()]=c},__removeDisplayObject:function(c){delete a[c.getUniqueId()]},getById:function(c){return c in a?a[c]:null}}})(this);(function(a){a.Shape=function(c){var b=this;a.DisplayObject.call(b,c);b.material.shader.setShaderProgramIds("color-shader-vs","color-shader-fs");return b};a.Shape.prototype=new DisplayObject();a.Shape.prototype.constructor=Shape})(this);(function(b){var c=function(e){var d=this;if(!e){e={}}this.name=undefined===e.name?"":e.name;this.startFrame=undefined===e.startFrame?0:e.startFrame;this.animationLength=undefined===e.animationLength?0:e.animationLength;this.frameRate=undefined===e.frameRate?60:e.frameRate;return d};var a=function(m){var i=this;if(undefined===m){m={}}if(undefined===m.width){throw new Error("Must define width and height!")}if(undefined===m.height){throw new Error("Must define width and height!")}if(undefined===m.mainTexture){throw new Error("Must define mainTexture!")}DisplayObject.call(i,m);i.material.shader.setShaderProgramIds("ss-shader-vs","ss-shader-fs");var n=[],f=null,h=0,d=0,j=i.material.mainTexture.getWidth()/i.getWidth(),o=i.material.mainTexture.getHeight()/i.getWidth(),l=1/j,g=1/o,e=new AnimationCurve();e.easingFunction=Easing.Quadratic.In;i.getBlendCurve=function(){return e};i.addAnimation=function(p){n.push(p)};i.removeAnimationByName=function(r){for(var q=0,p=n.length;q<p;q++){if(n[q].name===r){n=n.splice(q,0);return}}};i.setCurrentAnimationByName=function(r){if(null!==f&&f.name===r){return}for(var q=0,p=n.length;q<p;q++){if(n[q].name===r){f=n[q];return}}};i.getCurrentAnimation=function(){return f};i.setCurrentFrame=function(q){var p=f;if(null===p){return}if(q===d){return}d=q%p.animationLength;h=d*1000;k()};i.getCurrentFrame=function(){return d};i.setCurrentTime=function(r){var q=f;if(null===q){return}h=r;var p=Math.floor(1000/q.frameRate);var s=Math.floor(h/p)%q.animationLength;i.material.shader.setUniformFloat("uFutureBlendScalar",e.evaluate((h%p)/p));if(d===s){return}d=s;k()};i.update=function(p){i.setCurrentTime(h+p)};function k(){var w=f;if(null===w){return}var q=w.startFrame+d;var u=q%j;var s=Math.floor(q/j);var t=u/j;var r=s/o;var v=i.geometry.uvs;v[0]=t;v[1]=r;v[2]=t;v[3]=r+g;v[4]=t+l;v[5]=r;v[6]=t+l;v[7]=r+g;q=w.startFrame+(w.animationLength-1===d?0:d+1);u=q%j;s=Math.floor(q/j);t=u/j;r=s/o;var p=i.geometry.colors;p[0]=t;p[1]=r;p[4]=t;p[5]=r+g;p[8]=t+l;p[9]=r;p[12]=t+l;p[13]=r+g;i.geometry.apply()}return i};a.prototype=new DisplayObject();a.prototype.constructor=a;b.Animation=c;b.SpriteSheet=a})(this);(function(a){a.StaticImage=function(c){var b=this;if(undefined===c){c={}}if(undefined!==c.mainTexture){if(undefined===c.width){c.width=c.mainTexture.getWidth()}if(undefined===c.height){c.height=c.mainTexture.getHeight()}}DisplayObject.call(b,c);b.material.shader.setShaderProgramIds("texture-shader-vs","texture-shader-fs");return b};a.StaticImage.prototype=new DisplayObject();a.StaticImage.prototype.constructor=a.StaticImage})(this);(function(c){var b=signals.Signal;var a=function(){var d=this;d.onLoaded=new b();d.font=null;return d};a.prototype={constructor:a,load:function(h,e){var g=this;if(h[h.length-1]!=="/"){h+="/"}function i(){if(null!==d.image&&null!==f.data){g.font=new Font();g.font.initialize(new FontDefinition(f.data,d.image));g.onLoaded.dispatch()}}var d=new ImageLoader();d.onLoaded.addOnce(i);d.load(h+e+".png");var f=new XMLLoader();f.onLoaded.addOnce(i);f.load(h+e+".fnt")}};c.FontLoader=a})(this);var Signal=signals.Signal;var ImageLoader=(function(){return function(){var a=this;a.image=null;a.onLoaded=new Signal();return a}})();ImageLoader.prototype={constructor:ImageLoader,load:function(a,c){var b=this;if(undefined===c){c=new Image()}c.onload=function(){b.image=c;b.onLoaded.dispatch()};c.crossOrigin="localhost";c.src=a}};ImageLoader.loadResources=function(d,e){var b=0;function c(f){if(++b===d.length){e(a)}}var a=d.map(function(g){var f=new ImageLoader();f.onLoaded.add(c);f.load(g);return f})};(function(c){var b=signals.Signal;var a=function(){var d=this;d.onLoaded=new b();d.data=null;return d};a.prototype={constructor:a,load:function(d){var e=this;var f=HTTPHelper.newRequest(d);f.onreadystatechange=function(){if(4===f.readyState){e.data=f.responseText;e.onLoaded.dispatch(e)}};f.send(null)}};c.XMLLoader=a})(this);(function(a){if(!a.particle){a.particle={}}a.particle.Position=function(c,e,b,d){this.x=undefined===c?0:c;this.y=undefined===e?0:e;this.innerRadius=undefined===d?0:d;if(undefined===b){b=10}if(b<=this.innerRadius){b=this.innerRadius+1}this.radius=b};a.particle.Position.prototype={constructor:a.particle.Position,initialize:function(c,d){d.transform.position.x=this.x+(Math.random()-0.5)*Math.random()*(this.radius-this.innerRadius);d.transform.position.y=this.y+(Math.random()-0.5)*Math.random()*(this.radius-this.innerRadius);if(0!==this.innerRadius){var b=Math.random()*2*Math.PI;d.transform.position.x+=this.innerRadius*Math.sin(b);d.transform.position.y+=this.innerRadius*Math.cos(b)}}};a.particle.Rotation=function(c,b){this.min=undefined===c?0:c;this.max=undefined===b?Math.PI*2:b};a.particle.Rotation.prototype={constructor:a.particle.Rotation,initialize:function(b,c){c.transform.rotationInRadians=this.min+Math.random()*(this.max-this.min)}};a.particle.Velocity=function(d,e,b,c){this.minAngle=d;this.maxAngle=e;this.minMagnitude=b;this.maxMagnitude=c};a.particle.Velocity.prototype={constructor:a.particle.Velocity,initialize:function(c,e){var d=(this.minAngle+Math.random()*(this.maxAngle-this.minAngle));var b=(this.minMagnitude+Math.random()*(this.maxMagnitude-this.minMagnitude));e.vx=-Math.cos(d)*b;e.vy=-Math.sin(d)*b}};a.particle.Acceleration=function(b,c){this.x=b;this.y=c};a.particle.Acceleration.prototype={constructor:a.particle.Acceleration,initialize:function(b,c){c.ax=this.x;c.ay=this.y}};a.particle.Lifetime=function(c,b){this.min=c;this.max=b};a.particle.Lifetime.prototype={constructor:a.particle.Lifetime,initialize:function(b,c){c.lifetime=(this.min+Math.random()*(this.max-this.min))}};a.particle.Attractor=function(b,d,c){this.x=b;this.y=d;this.amount=c};a.particle.Attractor.prototype={constructor:a.particle.Attractor,update:function(b,c){c.ax=this.x-c.transform.position.x/this.amount;c.ay=this.y-c.transform.position.y/this.amount}};a.particle.ParticlePropertyAnimator=function(b,d,c){this.propName=b;this.curve=d;this.scale=c};a.particle.ParticlePropertyAnimator.prototype={constructor:a.particle.ParticlePropertyAnimator,update:function(b,c){c[this.propName]=this.scale=this.curve.evaluate(c.elapsedTime/c.lifetime)}};a.particle.ScaleAnimator=function(c,b){this.curve=c;this.scale=b};a.particle.ScaleAnimator.prototype={constructor:a.particle.ScaleAnimator,update:function(b,d){var c=this.scale*this.curve.evaluate(d.elapsedTime/d.lifetime);d.transform.scale.x=d.transform.scale.y=c}};a.particle.AlphaAnimator=function(c,b){return new a.particle.ParticlePropertyAnimator("alpha",c,b)};a.particle.RotationAnimator=(function(){var b=0;return function(d,c){this.__guid="__rotationRate"+b++;this.curve=d;this.scale=c}})();a.particle.RotationAnimator.prototype={constructor:a.particle.RotationAnimator,initialize:function(b,c){c[this.__guid]=c.transform.rotationInRadians},update:function(c,d,b){d.transform.rotationInRadians=d[this.__guid]+this.scale*this.curve.evaluate(d.elapsedTime/d.lifetime)}}})(this);(function(c){var a=function(e){var d=this;DisplayObject.call(d,{color:new Color(1,0,0,1)});d.transform.anchorPoint.x=d.transform.anchorPoint.y=1;d.material=e;d.material.shader.setShaderProgramIds("texture-shader-vs","texture-shader-fs");d.vx=0;d.vy=0;d.ax=0;d.ay=0;d.elapsedTime=0;d.isAlive=false;return d};a.prototype=new DisplayObject();a.prototype.constructor=a;var b=function(i,q,p,j){var r=this;DisplayObject.call(r);var h=i?[].concat(i):[],o=0,l=0,k=(undefined===j)?1000:j,f=new Set(),e=new ObjectPool(k,function d(){return new a(r.material)},function g(s){r.addChild(s);s.elapsedTime=0;s.isAlive=true;s.lifetime=r.lifetime},function n(s){r.removeChild(s);s.isAlive=false});r.material.shader.setShaderProgramIds("particle-shader-vs","particle-shader-fs");r.emissionRate=5;r.lifetime=1000;r.addPlugin=function(s){h.push(s);return r};r.removePlugin=function(t){var s=h.indexOf(t);if(-1!==s){h=h.splice(s,1)}return r};r.update=function(w){m(null,h,"updateGlobal",w);var x;var u=r.emissionRate;for(var t=l,s=l+u;t<s;t++){x=e.get();if(null===x){break}m(x,h,"initialize",w);f.add(x)}var v=f.getElements();for(t=0,s=v.length;t<s;t++){x=v[t];x.elapsedTime+=w;if(x.elapsedTime>=x.lifetime){f.remove(x);e.put(x);continue}x.vx+=x.ax;x.vy+=x.ay;x.transform.position.x+=x.vx;x.transform.position.y+=x.vy;m(x,h,"update",w)}m(null,h,"updateEndGlobal",w)};function m(y,t,x,w){for(var u=0,s=t.length;u<s;u++){var v=t[u];if("function"===typeof v[x]){v[x](r,y,w)}}}};b.prototype=new DisplayObject();b.prototype.constructor=b;c.Particle=a;c.ParticleEmitter=b})(this);(function(b){var a=function(d){var c=this;c.width=1;c.height=1;c.vertices=null;c.uvs=null;c.colors=null;c.vertexBuffer=null;c.uvBuffer=null;c.colorBuffer=null;c.__apply=true;return c};a.prototype={constructor:a,rebuild:function(c){this.vertices=new Float32Array(c*8);this.uvs=new Float32Array(c*8);this.colors=new Float32Array(c*16)},apply:function(){this.__apply=true},clearBuffers:function(){this.vertexBuffer=this.uvBuffer=this.colorBuffer=null},prepareBuffers:function(){if(null===this.vertexBuffer){this.vertexBuffer=ctx.createBuffer()}if(null===this.uvBuffer){this.uvBuffer=ctx.createBuffer()}if(null===this.colorBuffer){this.colorBuffer=ctx.createBuffer()}if(this.__apply){ctx.bindBuffer(ctx.ARRAY_BUFFER,this.vertexBuffer);ctx.bufferData(ctx.ARRAY_BUFFER,this.vertices,ctx.STATIC_DRAW);ctx.bindBuffer(ctx.ARRAY_BUFFER,this.uvBuffer);ctx.bufferData(ctx.ARRAY_BUFFER,this.uvs,ctx.STATIC_DRAW);ctx.bindBuffer(ctx.ARRAY_BUFFER,this.colorBuffer);ctx.bufferData(ctx.ARRAY_BUFFER,this.colors,ctx.STATIC_DRAW)}this.__apply=false},pushBuffers:function(c,d){if(-1<d.vertexBufferAttributePointer){c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.vertexAttribPointer(d.vertexBufferAttributePointer,2,c.FLOAT,false,0,0)}if(-1<d.uvBufferAttributePointer){c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.vertexAttribPointer(d.uvBufferAttributePointer,2,c.FLOAT,false,0,0)}if(-1<d.vertexColorBufferAttributePointer){c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.vertexAttribPointer(d.vertexColorBufferAttributePointer,4,c.FLOAT,false,0,0)}},draw:function(c){}};b.ParticleEmitterGeometry=a})(this);(function(c){var a=function(f,e){this.xmlDefinition=f;this.image=e};var b=function(){};b.prototype={constructor:b,toString:function(){return"[CharDefinition id: "+this.id+" x: "+this.x+" y: "+this.y+" width: "+this.width+" height: "+this.height+" xoffset: "+this.xoffset+" yoffset: "+this.yoffset+" xadvance: "+this.xadvance+" yadvance: "+this.yadvance+" page: "+this.page+" chnl: "+this.chnl+"]"}};b.FromXML=function(e){var f=new b();f.id=parseInt(e.getAttribute("id"),10);f.x=parseInt(e.getAttribute("x"),10);f.y=parseInt(e.getAttribute("y"),10);f.width=parseInt(e.getAttribute("width"),10);f.height=parseInt(e.getAttribute("height"),10);f.xoffset=parseInt(e.getAttribute("xoffset"),10);f.yoffset=parseInt(e.getAttribute("yoffset"),10);f.xadvance=parseInt(e.getAttribute("xadvance"),10);f.yadvance=parseInt(e.getAttribute("yadvance"),10);f.page=parseInt(e.getAttribute("page"),10);f.chnl=parseInt(e.getAttribute("chnl"),10);return f};var d=function(){var e=this;e.glyphIndex=[];return e};d.prototype={constructor:d,initialize:function(g){var k=XMLHelper.parse(g.xmlDefinition);var h=k.getElementsByTagName("char");for(var f=0,e=h.length;f<e;f++){var j=b.FromXML(h[f]);this.glyphIndex[j.id]=j}}};c.FontDefinition=a;c.Font=d})(this);(function(b){var a=function(d){var c=this;if(undefined===d){d={}}c.font=(undefined===d.font)?new Font():d.font;return c};a.prototype={constructor:a,setText:function(c){},appendText:function(c){}};b.TextField=a})(this);function extend(c,a){var b=function(){};b.prototype=a.prototype;c.prototype=new b();c.prototype.constructor=c;c.superclass=a.prototype;if(a.prototype.constructor==Object.prototype.constructor){a.prototype.constructor=a}}if(!Object.keys){Object.keys=(function(){var c=Object.prototype.hasOwnProperty,d=!({toString:null}).propertyIsEnumerable("toString"),b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=b.length;return function(g){if(typeof g!=="object"&&typeof g!=="function"||g===null){throw new TypeError("Object.keys called on non-object")}var e=[];for(var h in g){if(c.call(g,h)){e.push(h)}}if(d){for(var f=0;f<a;f++){if(c.call(g,b[f])){e.push(b[f])}}}return e}})()}(function(c){var b=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("MSXML2.XMLHTTP.3.0")},function(){return new ActiveXObject("MSXML2.XMLHTTP")}];var a={newRequest:(function(e){if(undefined===e){e="GET"}var d=null;return function(k){if(null===d){for(var l=0,f=b.length;l<f;l++){try{var j=b[l];var m=j();if(null!==m){d=j;break}}catch(h){continue}}if(null===d){d=function(){throw new Error("XMLHTTPRequest not supported.")}}}var g=d();g.open(e,k);g.setRequestHeader("User-Agent","XMLHttpRequest");g.setRequestHeader("Accept-Language","en");return g}})()};c.HTTPHelper=a})(this);(function(a){var b={newDocument:function(c,i){if(!c){c=""}if(!i){i=""}if(document.implementation&&document.implementation.createDocument){return document.implementation.createDocument(i,c,null)}var g=new ActiveXObject("MSXML2.DOMDocument");if(c){var e="";var d=c;var f=c.indexOf(":");if(-1!==f){e=c.substring(0,f);d=c.substring(f+1)}if(i){if(!e){e="a0"}}else{e=""}var h="<"+(e?e+":":"")+d+(i?(" xmlns:"+e+'="'+i+'"'):"")+"/>";g.loadXML(h)}return g},parse:function(f){if(typeof DOMParser!=="undefined"){return new DOMParser().parseFromString(f,"application/xml")}if(typeof ActiveXObject!=="undefined"){var e=b.newDocument();e.loadXML(f);return e}var c="data:text/xml;charset=utf-8,"+encodeURIComponent(f);var d=new XMLHttpRequest();d.open("GET",c,false);d.send(null);return d.responseXML}};a.XMLHelper=b})(this);var __buildTimestamp="Tue, 13 Aug 2013 05:41:07 -0700";